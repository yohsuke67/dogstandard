<div id="top-picture" class="custom-content">
  <img src="https://cdn.shopify.com/s/files/1/2115/6795/files/2018-01-19_14.16.55.png?9813748085116023006">
</div>

<form id="form" class='custom-form custom-content'>
  <div class="form-item" id='form-item-name'>
    <div class="form-item-label">
      <p>お名前</p>
    </div>
    <div class="form-item-content">
      <input class="full-width" name="name" type="text" placeholder="お名前" />
    </div>
    <div class="form-item-error"></div>
  </div>
  <div class="form-item" id='form-item-breed'>
    <div class="form-item-label">
      <p>犬種</p>
    </div>
    <div class="form-item-content">
      <select name="breed" class='full-width'>
        <option value="0">犬種を選択してください</option>
        <option value="1">アイリッシュウルフハウンド</option>
        <option value="2">アイリッシュセッター</option>
        <option value="3">秋田犬</option>
        <option value="4">アフガンハウンド</option>
        <option value="5">アメリカンコッカースパニエル</option>
        <option value="6">アメリカンスタッフォードシャーテリア</option>
        <option value="7">アメリカンピットブルテリア</option>
        <option value="8">アメリカンブリー</option>
        <option value="9">アラスカンマラミュート</option>
        <option value="10">イタリアングレーハウンド</option>
        <option value="11">イングリッシュコッカースパニエル</option>
        <option value="12">イングリッシュスプリンガースパニエル</option>
        <option value="13">イングリッシュセッター</option>
        <option value="14">イングリッシュポインター</option>
        <option value="15">ウィペット</option>
        <option value="16">ウェルシュテリア</option>
        <option value="17">ウエストハイランドホワイトテリア(ウエスティ)</option>
        <option value="18">エアデールテリア</option>
        <option value="19">オーストラリアンケルピー</option>
        <option value="20">オールドイングリッシュシープドッグ</option>
        <option value="21">甲斐犬</option>
        <option value="22">カニンヘンダックス</option>
        <option value="23">カーリーコーテッドレトリバー</option>
        <option value="24">紀州犬</option>
        <option value="25">キャバリア</option>
        <option value="26">キースホンド</option>
        <option value="27">グレートデン</option>
        <option value="28">グレートピレニーズ</option>
        <option value="29">ケアーンテリア</option>
        <option value="30">ケリーブルーテリア</option>
        <option value="31">コモンドール</option>
        <option value="32">コーイケルホンディエ</option>
        <option value="33">コーギー</option>
        <option value="34">ゴールデンレトリバー</option>
        <option value="35">サモエド</option>
        <option value="36">サルーキ</option>
        <option value="37">シェットランドシープドッグ(シェルティ)</option>
        <option value="38">シェパード</option>
        <option value="39">四国犬</option>
        <option value="40">柴犬</option>
        <option value="41">シベリアンハスキー</option>
        <option value="42">シャーペイ</option>
        <option value="43">シーズー</option>
        <option value="44">シーリハムテリア</option>
        <option value="45">ジャイアントシュナウザー</option>
        <option value="46">ジャックラッセルテリア</option>
        <option value="47">ジャーマンピンシャー</option>
        <option value="48">スキッパーキ</option>
        <option value="49">スコティッシュテリア(スコッチテリア)</option>
        <option value="50">スタッフォードシャーブルテリア(スタッフィー)</option>
        <option value="51">スタンダードシュナウザー</option>
        <option value="52">スタンダードダックス</option>
        <option value="53">スタンダードプードル</option>
        <option value="54">セントバーナード</option>
        <option value="55">タイニープードル</option>
        <option value="56">ダックスフンド</option>
        <option value="57">ダルメシアン</option>
        <option value="58">チェサピークベイレトリバー</option>
        <option value="59">チベタンスパニエル</option>
        <option value="60">チャイニーズ・クレステッド・ドッグ</option>
        <option value="61">チャウチャウ</option>
        <option value="62">チワワ</option>
        <option value="63">チワワ(スムース)</option>
        <option value="64">チワワ(ロング)</option>
        <option value="65">狆(チン)</option>
        <option value="66">ティーカッププードル</option>
        <option value="67">トイプードル</option>
        <option value="68">土佐犬</option>
        <option value="69">ドーベルマン</option>
        <option value="70">日本スピッツ</option>
        <option value="71">日本テリア</option>
        <option value="72">ニューファンドランド</option>
        <option value="73">ノーフォークテリア</option>
        <option value="74">ノーリッチテリア</option>
        <option value="75">バセットハウンド</option>
        <option value="76">バセンジー</option>
        <option value="77">バーニーズ・マウンテン・ドッグ</option>
        <option value="78">パグ</option>
        <option value="79">パピヨン</option>
        <option value="80">ビアデッドコリー</option>
        <option value="81">ビションフリーゼ</option>
        <option value="82">ビーグル</option>
        <option value="83">フラットコーテッドレトリバー</option>
        <option value="84">フレンチブルドッグ</option>
        <option value="85">ブリアード</option>
        <option value="86">ブリタニースパニエル</option>
        <option value="87">ブリュッセルグリフォン</option>
        <option value="88">ブルドッグ</option>
        <option value="89">ブービエ・デ・フランダース</option>
        <option value="90">プチバセットグリフォンバンデーン</option>
        <option value="91">プチブラバンソン</option>
        <option value="92">プードル</option>
        <option value="93">ベルジアングリフォン</option>
        <option value="94">ペキニーズ</option>
        <option value="95">北海道犬</option>
        <option value="96">ボクサー</option>
        <option value="97">ボストンテリア</option>
        <option value="98">ボルゾイ</option>
        <option value="99">ボロニーズ</option>
        <option value="100">ボーダーコリー</option>
        <option value="101">ポメラニアン</option>
        <option value="102">ポリッシュローランドシープドッグ</option>
        <option value="103">マスティフ</option>
        <option value="104">豆柴</option>
        <option value="105">マルチーズ</option>
        <option value="106">マンチェスターテリア</option>
        <option value="107">ミディアムプードル</option>
        <option value="108">ミニチュアシュナウザー</option>
        <option value="109">ミニチュアダックス</option>
        <option value="110">ミニチュアピンシャー</option>
        <option value="111">ミニチュアブルテリア</option>
        <option value="112">ミニチュアプードル</option>
        <option value="113">ヨークシャーテリア(ヨーキー)</option>
        <option value="114">ラサアプソ</option>
        <option value="115">ラフコリー</option>
        <option value="116">ラブラドールレトリバー</option>
        <option value="117">レオンベルガー</option>
        <option value="118">レークランドテリア</option>
        <option value="119">ロットワイラー</option>
        <option value="120">ワイアーフォックステリア</option>
        <option value="121">ワイマラナー</option>
      </select>
    </div>
    <div class="form-item-error"></div>
  </div>
  <div class="form-item" id='form-item-sex'>
    <div class="form-item-label">
      <p>性別</p>
    </div>
    <div class="form-item-content"> 
      <input type="radio" name="sex" value="1">メス</input>
      <input type="radio" name="sex" value="2">オス</input>
    </div>
    <div class="form-item-error"></div>
  </div>
  <div class="form-item" id='form-item-weight'>
    <div class="form-item-label">
      <p>体重</p>
    </div>
    <div class="form-item-content"> 
      <input name="weight" type="number" placeholder="体重" step="0.1" />
      <p class='sub-label'>kg</p>
    </div>
    <div class="form-item-error"></div>
  </div>
  <div class="form-item" id='form-item-age'>
    <div class="form-item-label">
      <p>年齢</p>
    </div>
    <div class="form-item-content"> 
      <select name="age" class='full-width'>
        <option value="0">年齢を選択してください</option>
        <option value="100">0 - 4ヶ月</option>
        <option value="200">4ヶ月 - 1歳未満</option>
        <option value="1">1歳</option>
        <option value="2">2歳</option>
        <option value="3">3歳</option>
        <option value="4">4歳</option>
        <option value="5">5歳</option>
        <option value="6">6歳</option>
        <option value="7">7歳</option>
        <option value="8">8歳</option>
        <option value="9">9歳</option>
        <option value="10">10歳</option>
        <option value="11">11歳</option>
        <option value="12">12歳</option>
        <option value="13">13歳</option>
        <option value="14">14歳</option>
        <option value="15">15歳</option>
        <option value="16">16歳</option>
        <option value="17">17歳</option>
        <option value="18">18歳</option>
        <option value="19">19歳</option>
        <option value="20">20歳以上</option>
      </select>
    </div>
    <div class="form-item-error"></div>
  </div>
  <div class="form-item" id='form-item-castration'>
    <div class="form-item-label">
      <p>去勢について</p>
    </div>
    <div class="form-item-content">  
      <select name="castration" class='full-width'>
        <option value="0">去勢について選択してください</option>
        <option value="1">去勢していない</option>
        <option value="2">去勢している</option>
      </select>
    </div>
    <div class="form-item-error"></div>
  </div>
   <div class="form-item" id='form-item-active_level'>
    <div class="form-item-label">
      <p>活動レベル</p>
    </div>
    <div class="form-item-content">  
      <select name="active_level" class='full-width'>
        <option value="0">活動レベルを選択してください</option>
        <option value="1">普通</option>
        <option value="2">活動的</option>
        <option value="3">肥満傾向で運動不足</option>
      </select>
    </div>
    <div class="form-item-error"></div>
  </div>
  <div class="form-item-submit">
    <button class="btn btn-primary form-item-submit-button" type="submit" id="submit">カロリー計算をする</button>
  </div>
</form>

<div id="result" class='custom-content'></div>

<div id="product-list" class='custom-content'></div>

<div id="description" class='custom-content'>
  <p>こちらで算出された、カロリー、グラム計算は、推奨値です。</p>
  <p>人間でも食べる量で太りやすい、痩せやすいなど、個人差があるように、犬も同じです。</p>
  <p>ここで推奨される犬の食事の量は、出発点として利用されることをお勧めしています。</p>
  <p>犬の体重は、１週間〜２週間ごとに測定し、大きな体重の変化があった場合は、最初の推奨量の調整をしていただくことをお勧めします。</p>
  <p>もしご心配な場合はかかりつけの獣医または弊社LINEにて、ご相談くださいませ。</p>
</div>

<script type="text/javascript">
  $('#submit').on('click', function(event) {
    event.preventDefault();
    // 名前
    name = $('#form [name=name]').val();
    // 犬種(カロリー計算ロジックには使用しない)
    breed = Number($('#form [name=breed]').val());
    // 性別
    sex = $('#form [name=sex]:checked').val() == null ? 0 : Number($('#form [name=sex]:checked').val());
    // 体重
    weight = Number($('#form [name=weight]').val());
    // 年齢
    age = Number($('#form [name=age]').val());
    // 去勢
    castration = Number($('#form [name=castration]').val());
    // 活動レベル
    activeLevel = Number($('#form [name=active_level]').val());

    // ユーザの入力値をバリデーションにかける
    errors = validate(name, breed, sex, weight, age, castration, activeLevel);

    if (errors !== null) {
      // バリデーションエラーをクリアする
      clearErrors();
      // バリデーションエラーを表示する
      showErrors(errors);
    } else {
      // バリデーションエラーをクリアする
      clearErrors();
      // 必要なカロリー数
      calories = calculateCalories(weight, age, castration, activeLevel);
      // 表示名
      name = displayName(name, sex);
      // $('#result') の要素の出力
      updateResultDom(name, calories);
      // $('#product-list') の要素の出力
      updateProductListDom(calories);
    }
  });

  // エラーを表示する
  function showErrors(errors) {
    if (errors.name) {
      $('#form-item-name').find('.form-item-label').css({'color': 'red'});
      $('#form-item-name').find('.form-item-error').append($('<p>').text('お名前が入力されていません'));
    }
    if (errors.breed) {
      $('#form-item-breed').find('.form-item-label').css({'color': 'red'});
      $('#form-item-breed').find('.form-item-error').append($('<p>').text('犬種が選択されていません'));
    }
    if (errors.sex) {
      $('#form-item-sex').find('.form-item-label').css({'color': 'red'});
      $('#form-item-sex').find('.form-item-error').append($('<p>').text('性別が選択されていません'));
    }
    if (errors.weight) {
      $('#form-item-weight').find('.form-item-label').css({'color': 'red'});
      $('#form-item-weight').find('.form-item-error').append($('<p>').text('体重が入力されていません'));
    }
    if (errors.age) {
      $('#form-item-age').find('.form-item-label').css({'color': 'red'});
      $('#form-item-age').find('.form-item-error').append($('<p>').text('年齢が選択されていません'));
    }
    if (errors.castration) {
      $('#form-item-castration').find('.form-item-label').css({'color': 'red'});
      $('#form-item-castration').find('.form-item-error').append($('<p>').text('去勢についてが選択されていません'));
    }
    if (errors.activeLevel) {
      $('#form-item-active_level').find('.form-item-label').css({'color': 'red'});
      $('#form-item-active_level').find('.form-item-error').append($('<p>').text('活動レベルが選択されていません'));
    }
  }

  // エラーをクリアする
  function clearErrors() {
    $('.form-item-label').css({'color': 'black'});
    $('.form-item-error').empty();
  }

  // ユーザの入力値をバリデートする
  function validate(name, breed, sex, weight, age, castration, activeLevel) {
    errors = {
      name: false,
      breed: false,
      sex: false,
      weight: false,
      age: false,
      castration: false,
      activeLevel: false
    };
    errorsCount = 0;
    if (name == '') {
      errors.name = true;
      errorsCount++;
    }
    if (breed == 0) {
      errors.breed = true;
      errorsCount++;
    }
    if (sex == 0) {
      errors.sex = true
      errorsCount++;
    }
    if (weight == 0) {
      errors.weight = true;
      errorsCount++;
    }
    if (age == 0) {
      errors.age = true;
      errorsCount++;
    }
    if (castration == 0) {
      errors.castration = true;
      errorsCount++;
    }
    if (activeLevel == 0) {
      errors.activeLevel = true;
      errorsCount++;
    }
    if (errorsCount > 0) {
      return errors;
    } else {
      return null;
    }
  }

  // $('#result') の要素の出力
  function updateResultDom(displayName, calories) {
    // $('#result') の要素内を一旦クリアする
    $('#result').empty();
    // $('#result') に必要カロリー数の計算結果を出力する
    $('#result').append("<table id='result-table'><tr><th class='result-table-left'>" + displayName + "に1日に必要なカロリー数</th><th class='result-table-right'>" + calories  + "kcal</th></tr></table>");
  }

  // $('#product-list') の要素の出力
  function updateProductListDom(calories) {
    productList = [
      {
        name: 'チキン＆ライス',
        id: 'chicken-rice',
        gram: calculateGram(calories * 0.759),
        img: 'https://cdn.shopify.com/s/files/1/2115/6795/files/b00f2c3966be66e580bf324c65ededb2.png?14299376621769663929'
      },
      {
        name: 'フィッシュ＆ポテト',
        id: 'fish-potato',
        gram: calculateGram(calories * 0.732),
        img: 'https://cdn.shopify.com/s/files/1/2115/6795/files/eb4d84eb89780287e46453600317a40d.png?14299376621769663929'
      },
      {
        name: 'ビーフ＆ポテト',
        id: 'beef-poteto',
        gram: calculateGram(calories * 0.693),
        img: 'https://cdn.shopify.com/s/files/1/2115/6795/files/5aa7f7e8d9e5054812ab70cbb588e9b7.png?14299376621769663929'
      },
      {
        name: 'ラム＆ライス',
        id: 'rum-rice',
        gram: calculateGram(calories * 0.577),
        img: 'https://cdn.shopify.com/s/files/1/2115/6795/files/88991d70a90fed71b74b7238c22294b9.png?14299376621769663929'
      }
    ];

    // $('#product-list') の要素内を一旦クリアする
    $('#product-list').empty();

    // 要素構築
    table = $("<table id='product-list-table'></table>");
    thead = $('<thead>');
    tbody = $('<tbody>');
    thead.append($("<tr><th>商品画像</th><th>商品名</th><th>1日に必要なグラム数(g)</th><th></th><th></th><th></th></tr>"));
    for (i = 0; i < productList.length; i++) {
      item = productList[i]
      productUrl = "https://mydogstandard.com/products/" + item.id
      tbody.append($("<tr><td><img src='" + item.img + "'></td><td>" + item.name + "</td><td class='gram'>" + item.gram + "g</td><td><a href='" + productUrl + "?gram=" + item.gram + "'><button type='button' class='btn btn-primary product-detail'>個別商品</button></a></td><td><a href='" + productUrl + "?gram=" + item.gram + "&count=14'><button type='button' class='btn btn-primary product-detail'>14パック</button></a></td><td><a href='" + productUrl + "?gram=" + item.gram + "&count=28'><button type='button' class='btn btn-primary product-detail'>28パック</button></a></td></tr>"));
    }
    table.append(thead);
    table.append(tbody);

    // $('#product-list') に必要なカロリー数に応じた g 数を、商品毎に計算して出力する
    $('#product-list').append(table);
  }

  // グラム計算
  function calculateGram(value) {
    // 1 の位で四捨五入する
    return Math.round(value / 10) * 10;
  }

  // 表示名
  function displayName(name, sex) {
    // sex: 1..メス/2..オス
    return name + (sex == '1' ? 'ちゃん' : 'くん');
  }
  
  // カロリー計算
  function calculateCalories(weight, age, castration, activeLevel) {
    calories = 0;
    if (age == 100) {
      // 0 - 4ヶ月
      calories = 4.0 * (70 * (weight ** 0.75));
    } else if (age == 200) {
      // 4ヶ月 - 1歳
      calories = 1.5 * (70 * (weight ** 0.75));
    } else if (age > 0 && age < 7) {
      // 1歳 - 6歳
      if (castration == 1) {
        // 去勢していない
        if (activeLevel == 1) {
          calories = 1.45 * (70 * (weight ** 0.75));
        } else if (activeLevel == 2) {
          calories = 1.6 * (70 * (weight ** 0.75));
        } else {
          calories = 1.4 * (70 * (weight ** 0.75));
        } 
      } else {
        // 去勢している
        if (activeLevel == 1) {
          calories = 1.25 * (70 * (weight ** 0.75));
        } else if (activeLevel == 2) {
          calories = 1.4 * (70 * (weight ** 0.75));
        } else {
          calories = 1.2 * (70 * (weight ** 0.75));
        }
      }
    } else {
      // 7歳以上
      if (castration == 1) {
        // 去勢していない
        if (activeLevel == 1) {
          calories = 1.3 * (70 * (weight ** 0.75));
        } else if (activeLevel == 2) {
          calories = 1.45 * (70 * (weight ** 0.75));
        } else {
          calories = 1.2 * (70 * (weight ** 0.75));
        }
      } else {
        // 去勢している
        if (activeLevel == 1) {
          calories = 1.1 * (70 * (weight ** 0.75));
        } else if (activeLevel == 2) {
          calories = 1.25 * (70 * (weight ** 0.75));
        } else {
          calories = 1.0 * (70 * (weight ** 0.75));
        }
      }
    }

    // カロリー数を小数点以下四捨五入
    return Math.round(calories);
  }
</script>

<style type="text/css">
<!--
  /* すべてのコンテンツの共通属性 */
  .custom-content {
    width: 70%;
    margin: 50px auto;
  }
  /* フォーム部分 */
  .custom-form .form-item {
    height: 70px;
  }
  .custom-form .form-item .form-item-label {
    float: left;
    width: 20%;
  }
  .custom-form .form-item .form-item-label p {
    font-size: 16px;
    font-weight: bold;
    margin: 0;
  }
  .custom-form .form-item .form-item-content {
    float: left;
    width: 80%;
    position: relative;
  }
  .custom-form .form-item .form-item-content .full-width {
    width: 100%;
  }
  .custom-form .form-item .form-item-content .sub-label {
    font-size: 15px;
    position: absolute;
    font-weight: bold;
    top: -14px;
    left: 115px;
  }
  .custom-form .form-item .form-item-error {
    margin-left: 20%;
    color: red;
  }
  .custom-form .form-item-submit {
    width: 100%;
  }
  .custom-form .form-item-submit .form-item-submit-button {
    margin: 0;
    width: 100%;
  }
  /* トップ画像 */
  #top-picture img {
    width: 100%;
    height: 100%;
  }
  /* カロリー計算結果テーブル */
  #result-table tr .result-table-left {
    width: 50%;
    border: 1px solid #999;
    color: #FFF;
    background-color: #999;
    font-size: 15px;
  }
  #result-table tr .result-table-right {
    width: 50%;
    border: 1px solid #999;
    color: #999;
    font-size: 30px;
  }
  /* 商品リストテーブル */
  #product-list-table thead tr {
    background: #999 !important;
    color: #FFF;
    border-bottom: 1px solid #000;
  }
  #product-list-table tr .gram {
    font-size: 18px;
  }
  #product-list-table tr:nth-child(2n) {
    background: #eee;
  }
  #product-list-table .product-detail {
    padding: 8px 15px;
    font-size: 12px;
  }
  /* 説明書き */
  #description {
    padding: 20px;
    border: 2px solid #999;
    color: #999;
    font-size: 15px;
  }
-->
</style>
