<script type="text/javascript">
  // getParameterメソッドを定義する。keyは、パラメーターの名前をいれる
  function getParameter(key) {
    // パラメーターを配列で取得する
    var str = location.search.split("?");
    if (str.length < 2) {
      return "";
    }
    var params = str[1].split("&");
    for (var i = 0; i < params.length; i++) {
      var keyVal = params[i].split("=");
      if (keyVal[0] == key && keyVal.length == 2) {
        return decodeURIComponent(keyVal[1]);
      }
    }
    return "";
  }

  // 取得したパラメータで、グラム数とパック数を更新する
  window.onload = function() {
    // グラム数選択の更新
    var selectorGram = document.getElementById('productSelect--product-template-option-0');
    var targetGram = getParameter("gram")+"g";
    for (var i = 0; i < selectorGram.options.length; i++) {
      if (selectorGram.options[i].value == targetGram) {
        selectorGram.options[i].selected = true;
      }
    }
    // パック数選択の更新
    var selectorCount = document.getElementById('Quantity1');
    var count = getParameter("count");
    if (count) {
      selectorCount.value = count;
    }
    // 値段の更新
    var selectorPrice = document.getElementById('ProductPrice');
    var targetVariantPrice = null;
    for (var i = 0;  i < product.variants.length; i++) {
      variant = product.variants[i];
      if (variant.title == targetGram) {
        targetVariantPrice = variant.price;
        break;
      }
    }
    if (targetVariantPrice) {
      // 何故か 0 が二つついているので、文字列化してスライスし、¥ を先頭につける
      selectorPrice.innerHTML  = '¥' + String(targetVariantPrice).slice(0, -2);
    }
  }
</script>
